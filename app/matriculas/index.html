<!-- Bread crumb is created dynamically -->
<!-- row -->
<!-- row -->
<div class="row">
	<!-- col -->
	<!-- <div class="col-xs-12 col-sm-7 col-md-7 col-lg-4">
		<h1 class="page-title txt-color-blueDark">

			PAGE HEADER
			<i class="fa-fw fa fa-home"></i>
				Matrículas
			<span>>
				Cadastro de matrículas
			</span>
		</h1>
	</div> -->
	<!-- end col -->


</div>
<!-- end row -->


	<!-- row -->

	<div class="row">

		<!-- a blank row to get started -->
		<div class="col-sm-12">
			<!-- your contents here -->

			<legend>Filtros</legend>
			<div class="row">
				<div class="col-md-4">
					<div class="form-group">
						<select id="filtro_curso" style="width:100%" class="select2 filtro-grid" data-id='1'></select>
					</div>
				</div>
				<div class="col-md-4">
					<div class="form-group">
						<select id="filtro_status" style="width:100%" class="select2 filtro-grid" data-id='7'></select>
					</div>
				</div>
				<div class="col-md-4">
					<div class="form-group">
						<select id="filtro_status_pgto" style="width:100%" class="select2 filtro-grid" data-id='7'></select>
					</div>
				</div>
			</div>
			<p></p>
			<ul class="list-inline">
				<li><button id="btn-novo-cadastro" type="button" class="btn btn-sm btn-labeled btn-primary"><span class="btn-label"><i class="fa fa-plus"></i></span>Novo</button></li>
				<li><button id="btn-atualizar" type="button" class="btn btn-sm btn-labeled bg-color-pinkDark txt-color-white" title="Atualizar listagem"><span class="btn-label"><i class="fa fa-refresh"></i></span>Atualizar</button></li>
				<li><button id="btn-resetar-filtros" type="button" class="btn btn-sm btn-labeled btn-default" title="Resetar filtros"><span class="btn-label"><i class="fa fa-ban"></i></span>Resetar filtros</button></li>
			</ul>

			<!-- Widget ID (each widget will need unique ID)-->
			<div class="jarviswidget jarviswidget-color-blueDark" id="wid-id-1" data-widget-editbutton="false">
				<!-- widget options:
				usage: <div class="jarviswidget" id="wid-id-0" data-widget-editbutton="false">

				data-widget-colorbutton="false"
				data-widget-editbutton="false"
				data-widget-togglebutton="false"
				data-widget-deletebutton="false"
				data-widget-fullscreenbutton="false"
				data-widget-custombutton="false"
				data-widget-collapsed="true"
				data-widget-sortable="false"

				-->
				<header>
					<span class="widget-icon"> <i class="fa fa-table"></i> </span>
					<h2>Listagem de <span id="txt-entity-multiple"></span></h2>

				</header>

				<!-- widget div-->
				<div>

					<!-- widget edit box -->
					<div class="jarviswidget-editbox">
						<!-- This area used as dropdown edit box -->

					</div>
					<!-- end widget edit box -->

					<!-- widget content -->
					<div class="widget-body no-padding">

						<table id="datatable_fixed_column" class="table table-striped table-bordered" width="100%">

					        <thead>
								<tr class="DT_Filter"></tr> <!-- LINHA PARA DOS FILTROS POR COLUNA -->
					            <tr class="DT_Title"></tr> <!-- LINHA DO TÍTULO DAS COLUNAS -->
					        </thead>
						</table>

					</div>
					<!-- end widget content -->

				</div>
				<!-- end widget div -->

			</div>
			<!-- end widget -->









			<!--#### MODAL DE CADASTRO ####-->
			<div class="modal fade" id="modal-cadastro" role="dialog" aria-hidden="true">
			    <div class="modal-dialog">
			        <div class="modal-content">

						<!--#### FORM DE CADASTRO ####-->
						<form name="form-cadastro" id="form-cadastro" action="" method="post" enctype="multipart/form-data">
							<div class="modal-header">
								<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
									&times;
								</button>
								<h4 class="modal-title">Cadastro de <span id="txt-entity-single"></span></h4>
							</div>
							<div class="modal-body">
								<div class="row" id="id-reg">
									<div class="col-md-12">
										<div class="form-group">ID <strong><span id="id_reg"></span></strong> <i id="txt_id_reg" class="fa fa-history bigger-120" rel="popover-html" data-rel="reg_user_popover" data-trigger="hover" data-placement="right" data-content="" title="Histórico do registro"></i></div>
									</div>
								</div>
								<legend>Dados do Curso</legend>
								<div class="row">
									<div class="col-md-10">
										<div class="form-group">
											<label for="cursos_curs_id" class="control-label">Curso</label>
											<select name="cursos_curs_id" id="cursos_curs_id" style="width:100%" class="select2" required data-msg="Escolha o curso" data-status="NaoAtribuir"></select>
										</div>
									</div>
									<div class="col-md-10">
										<div class="form-group">
											<label for="curs_nome" class="control-label">Curso</label>
											<input name="curs_nome" id="curs_nome" type="text" class="form-control" readonly data-status="NaoAtribuir" />
										</div>
									</div>
									<div class="col-md-4">
										<div class="form-group">
											<label for="curs_valor_matricula" class="control-label">Valor da matrícula</label>
											<input name="curs_valor_matricula" id="curs_valor_matricula" type="text" class="form-control" readonly data-status="NaoAtribuir" />
										</div>
									</div>
									<div class="col-md-4">
										<div class="form-group">
											<label for="curs_valor_mensalidade" class="control-label">Valor da mensalidade</label>
											<input name="curs_valor_mensalidade" id="curs_valor_mensalidade" type="text" class="form-control" readonly data-status="NaoAtribuir" />
										</div>
									</div>
									<div class="col-md-4">
										<div class="form-group">
											<label for="curs_duracao" class="control-label">Duração do curso (meses)</label>
											<input name="curs_duracao" id="curs_duracao" type="text" class="form-control" readonly data-status="NaoAtribuir" />
										</div>
									</div>
									<input type="hidden" name="curs_periodo" id="curs_periodo" data-status="NaoAtribuir">
								</div>
								<legend>Dados do aluno</legend>
								<div class="row">
									<div id="linha_pesq_aluno">
										<div class="col-md-8">
											<div class="form-group">
												<label for="pesq_aluno" class="control-label">Pesquisar aluno</label>
												<input name="pesq_aluno" id="pesq_aluno" type="text" class="form-control" placeholder="Digite o CPF ou Nome para pesquisar" />
											</div>
										</div>
										<div class="col-md-1">
											<div style="float: left; padding-top: 23px;">
												<a id="btn-pesquisa-aluno" href="javascript:void(0);" class="btn btn-default btn-sm" title="Pesquisar aluno"><i class="fa fa-search fa-lg"></i></a>
											</div>
										</div>
									</div>

									<div class="col-md-6">
										<div class="form-group">
											<label for="alun_nome" class="control-label">Nome</label>
											<input name="alun_nome" id="alun_nome" type="text" class="form-control" readonly data-status="NaoAtribuir" />
											<input type="hidden" name="alunos_alun_id" id="alunos_alun_id" required data-msg="Escolha o aluno" data-status="NaoAtribuir">
										</div>
									</div>
									<div class="col-md-2">
										<div class="form-group">
											<label for="alun_cpf" class="control-label">CPF</label>
											<input name="alun_cpf" id="alun_cpf" type="tel" class="form-control" readonly data-status="NaoAtribuir" />
										</div>
									</div>
									<div class="col-md-2">
										<div class="form-group">
											<label for="alun_rg" class="control-label">RG</label>
											<input name="alun_rg" id="alun_rg" type="text" class="form-control" readonly data-status="NaoAtribuir" />
										</div>
									</div>
									<div class="col-md-2">
										<div class="form-group">
											<label for="alun_dtnascimento" class="control-label">Nascimento</label>
											<input type="text" name="alun_dtnascimento" id="alun_dtnascimento" class="form-control" readonly data-status="NaoAtribuir" />
										</div>
									</div>
								</div>
								<legend>Dados da Matrícula</legend>
								<div class="row">
									<div class="col-md-3">
										<div class="form-group">
											<label for="matr_ano" class="control-label">Ano Letivo</label>
											<input name="matr_ano" id="matr_ano" type="text" class="form-control" placeholder="Ano Letivo" required data-rule-number="true" data-rule-min="2018" data-msg-number="Somente números" data-msg-min="Mínimo de 2018" data-msg="Preencha o ano letivo" />
										</div>
									</div>
									<div class="col-md-4">
										<div class="form-group">
											<label for="matr_status" class="control-label">Status da matrícula</label>
											<select name="matr_status" id="matr_status" style="width:100%" class="select2" required data-msg="Escolha o status"></select>
										</div>
									</div>
									<div class="col-md-3">
										<div class="form-group">
											<label for="matr_status_nome" class="control-label">Status da matrícula</label>
											<input name="matr_status_nome" id="matr_status_nome" type="text" class="form-control" readonly />
										</div>
									</div>
									<div class="col-md-4">
										<div class="form-group">
											<label for="matr_status_pgto" class="control-label">Matrícula paga?</label>
											<input name="matr_status_pgto" id="matr_status_pgto" type="text" class="form-control" readonly />
										</div>
									</div>
									<div class="col-md-4">
										<div class="form-group">
											<label for="matr_legado" class="control-label">Código Legado</label>
											<input name="matr_legado" id="matr_legado" type="text" class="form-control" placeholder="Código Legado" />
										</div>
									</div>
								</div>
							</div>
							<div class="modal-footer">
								<button id="btn-fechar" type="button" class="btn btn-labeled btn-default" data-dismiss="modal"><span class="btn-label"><i class="fa fa-times"></i></span>Cancelar</button>
								<button id="btn-inserir" type="submit" class="btn btn-labeled btn-primary" data-id="inserir"><span class="btn-label"><i class="fa fa-check"></i></span>Inserir</button>
								<button id="btn-alterar" type="submit" class="btn btn-labeled btn-success" data-id="alterar"><span class="btn-label"><i class="fa fa-check"></i></span>Alterar</button>
								<button id="btn-pagar" type="button" class="btn btn-labeled btn-warning" data-id="pagar"><span class="btn-label"><i class="fa fa-dollar"></i></span>Pagar</button>
								<button id="btn-cancelar" type="button" class="btn btn-labeled btn-danger" data-id="cancelar"><span class="btn-label"><i class="fa fa-ban"></i></span>Cancelar</button>
							</div>
							<div id="tblParcelas" style="display: none;"></div>
						</form>
						<!--#### FORM DE CADASTRO ####-->

			        </div>
			    </div>
			</div>
			<!--#### MODAL DE CADASTRO ####-->






		</div>

	</div>

	<!-- end row -->



<script type="text/javascript">

	pageSetUp();

	/*
	 * ALL PAGE RELATED SCRIPTS CAN GO BELOW HERE
	 * eg alert("my home function");
	 *
	 * var pagefunction = function() {
	 *   ...
	 * }
	 * loadScript("js/plugin/_PLUGIN_NAME_.js", pagefunction);
	 *
	 * TO LOAD A SCRIPT:
	 * var pagefunction = function (){
	 *  loadScript(".../plugin.js", run_after_loaded);
	 * }
	 *
	 * OR you can load chain scripts by doing
	 *
	 * loadScript(".../plugin.js", function(){
	 * 	 loadScript("../plugin.js", function(){
	 * 	   ...
	 *   })
	 * });
	 */

	 //TODO: FALTA CRIAR A PARTE DE CANCELAMENTO DE MATRÍCULA E O MÓDULO FINANCEIRO

	/*### DEFINIÇÕES GERAIS DO MÓDULO DE CURSO ###*/
	var $ModuleDefsCurso = {
		"Name":"Curso", //IDENTIFICADOR INTERNO DO MÓDULO (REFERÊNCIA PARA PERMISSÃO DE ACESSO)
		"Prefix":"curs_", //PREFIXO DOS CAMPOS DO MÓDULO (USADOS NA TABELA DO BANCO DE DADOS)
		"Title":"Cadastro de Cursos", //TÍTULO DO MÓDULO
		"Entity":"Curso", //ENTIDADE DO MÓDULO (REFERÊNCIA PARA CLASSE)
		"Table":"Cursos", //NOME DA TABELA NO BANCO DE DADOS
		"EntitySingle":"Curso", //ENTIDADE DO MÓDULO (SINGULAR)
		"EntityMultiple":"Cursos" //ENTIDADE DO MÓDULO (PLURAL)
	};
	/*### DEFINIÇÕES GERAIS DO MÓDULO DE CURSO ###*/

	/*### FUNÇÃO QUE RESETA O FORMULÁRIO QUANDO CLICA NOS BOTÕES DE AÇÃO ###*/
	//action = ação do formulário (novo, inserir, alterar, excluir, etc)
	//IdElementForm = ID do elemento FORM dos cadastros principais
	function ResetForm(action, IdElementForm) {

		//RESETA O FORMULÁRIO (EXCETO SELECT2 E CAMPOS ESPECIAIS)
		$("#"+IdElementForm).trigger('reset');

		//RESETA CAMPOS CAMPOS ESPECIAIS
		$("#"+IdElementForm+" :input[id=cursos_curs_id]").val('').select2().trigger('change');
		$("#"+IdElementForm+" :input[id=matr_status]").val('').select2().trigger('change');

		//ESCONDE BOTÕES DE PAGAR E CANCELAR
		$('#btn-pagar').hide();
		$('#btn-cancelar').hide();

		if(action=='novo') {

			$("#"+IdElementForm+" #cursos_curs_id").closest('.form-group').show();

			$("#"+IdElementForm+" #linha_pesq_aluno").show();

			//MOSTRA CAMPO DE STATUS
			$("#"+IdElementForm+" #matr_status").closest('.col-md-4').show();

			//ESCONDE CAMPO DE MATRÍCULA PAGA
			$("#"+IdElementForm+" #matr_status_pgto").closest('.form-group').hide();

			//ESCONDE CAMPO DE NOME DE STATUS
			$("#"+IdElementForm+" input[name=matr_status_nome]").closest('.form-group').hide();

			$("#"+IdElementForm+" input[name=alun_nome]").closest('.form-group').hide();
			$("#"+IdElementForm+" input[name=alun_cpf]").closest('.form-group').hide();
			$("#"+IdElementForm+" input[name=alun_rg]").closest('.form-group').hide();
			$("#"+IdElementForm+" input[name=alun_dtnascimento]").closest('.form-group').hide();

			$("#"+IdElementForm+" input[name=curs_nome]").closest('.form-group').hide();
			$("#"+IdElementForm+" input[name=curs_valor_matricula]").closest('.form-group').hide();
			$("#"+IdElementForm+" input[name=curs_valor_mensalidade]").closest('.form-group').hide();
			$("#"+IdElementForm+" input[name=curs_duracao]").closest('.form-group').hide();
		}
	}
	/*### FUNÇÃO QUE RESETA O FORMULÁRIO QUANDO CLICA NOS BOTÕES DE AÇÃO ###*/


	/*### FUNÇÃO PARA EXECUTAR AÇÕES ADICIONAIS AO ACTIONFORM ###*/
	function AdditionalActionForm(IdElementForm, action, data, textStatus, jqXHR, DataTable, ModuleDefs, IdModalElement) {

		console.log("\nAdditionalActionForm");
		console.log(IdElementForm);
		console.log(action);
		console.log(data);
		console.log(data.Options);
		console.log(ModuleDefs);
		console.log(data.origem);
		console.log(DataTable);



		/*### AÇÕES QUANDO RETORNA A BUSCA DE MATRÍCULA EXISTENTE ###*/
		if((action=="selecionar")&&(ModuleDefs.Entity=="Matricula")) {

			//ESCONDE O CAMPO DE CURSO
			$("#"+IdElementForm+" #cursos_curs_id").closest('.form-group').hide();

			//ATRIBUI O CURSO DA MATRÍCULA
			$("#"+IdElementForm+" :input[id=cursos_curs_id]").val(data[0].curs_id);

			//ATRIBUI O ALUNO DA MATRÍCULA
			$("#"+IdElementForm+" :input[id=alunos_alun_id]").val(data[0].alun_id);

			//ESCONDE A LINHA DE PESQUISA DE ALUNO
			$("#"+IdElementForm+" #linha_pesq_aluno").hide();

			//MOSTRA CAMPO DE MATRÍCULA PAGA
			$("#"+IdElementForm+" input[name=matr_status_pgto]").closest('.form-group').show();

			//ESCONDE CAMPO DE STATUS
			$("#"+IdElementForm+" #matr_status").closest('.col-md-4').hide();

			//MOSTRA CAMPO DE NOME DE STATUS
			$("#"+IdElementForm+" input[name=matr_status_nome]").closest('.form-group').show();

			//MOSTRA BOTÕES DE PAGAR E CANCELAR
			$('#btn-pagar').show();
			$('#btn-cancelar').show();

			/*### PREENCHE OS DADOS DO ALUNO ###*/
			$("#"+IdElementForm+" input[name=alun_nome]").val(data[0].alun_nome);
			$("#"+IdElementForm+" input[name=alun_cpf]").val(data[0].alun_cpf);
			$("#"+IdElementForm+" input[name=alun_rg]").val(data[0].alun_rg);
			$("#"+IdElementForm+" input[name=alun_dtnascimento]").val(data[0].alun_dtnascimento);
			$("#"+IdElementForm+" input[name=alunos_alun_id]").val(data[0].alun_id);
			/*### PREENCHE OS DADOS DO ALUNO ###*/

			/*### MOSTRA OS CAMPOS DO ALUNO ###*/
			$("#"+IdElementForm+" input[name=alun_nome]").closest('.form-group').show();
			$("#"+IdElementForm+" input[name=alun_cpf]").closest('.form-group').show();
			$("#"+IdElementForm+" input[name=alun_rg]").closest('.form-group').show();
			$("#"+IdElementForm+" input[name=alun_dtnascimento]").closest('.form-group').show();
			/*### MOSTRA OS CAMPOS DO ALUNO ###*/



			/*### PREENCHE OS DADOS DO CURSO ###*/
			$("#"+IdElementForm+" input[name=curs_nome]").val(data[0].curs_nome + ' - ' + data[0].curs_ch + 'h ' + ' - ' + data[0].tabedinavalo_descricao);
			$("#"+IdElementForm+" input[name=curs_valor_matricula]").val(data[0].curs_valor_matricula);
			$("#"+IdElementForm+" input[name=curs_valor_mensalidade]").val(data[0].curs_valor_mensalidade);
			$("#"+IdElementForm+" input[name=curs_duracao]").val(data[0].curs_duracao);
			/*### PREENCHE OS DADOS DO CURSO ###*/

			/*### MOSTRAS OS CAMPOS COM OS DADOS DO CURSO ###*/
			$("#"+IdElementForm+" input[name=curs_nome]").closest('.form-group').show();
			$("#"+IdElementForm+" input[name=curs_valor_matricula]").closest('.form-group').show();
			$("#"+IdElementForm+" input[name=curs_valor_mensalidade]").closest('.form-group').show();
			$("#"+IdElementForm+" input[name=curs_duracao]").closest('.form-group').show();
			/*### MOSTRAS OS CAMPOS COM OS DADOS DO CURSO ###*/

			$("#tblParcelas").html(data[0].tbl_parcelas);
		}
		/*### AÇÕES QUANDO RETORNA A BUSCA DE MATRÍCULA EXISTENTE ###*/


		/*### AÇÕES QUANDO É UM NOVO CADASTRO DE MATRÍCULA ###*/
		if((action=="novo")&&(ModuleDefs.Entity=="Matricula")) {

			/*### AÇÕES QUANDO ESCOLHE UM CURSO (onChange) ###*/
			$("#"+IdElementForm+" #cursos_curs_id").on('change', function(event) {

				var id_reg = $(this).val();

				if(id_reg>0) {

					//CRIA O formData
					var formData = new FormData();

					//ADICIONA O ORIGEM
					formData.append('origem','matricula');

					//LIMPA OS DADOS DO ALUNO
					LimpaCurso(IdElementForm);

					//PREENCHE O FORMULÁRIO DE PESSOAS
					ActionForm('selecionar', formData, id_reg, '', DataTable, IdElementForm, $ModuleDefsCurso, IdModalElement);
				}
			});
			/*### AÇÕES QUANDO ESCOLHE UM CURSO (onChange) ###*/
		}
		/*### AÇÕES QUANDO É UM NOVO CADASTRO DE MATRÍCULA ###*/



		/*### AÇÕES QUANDO RETORNA A BUSCA DE ALUNOS PARA NOVA MATRÍCULA ###*/
		if((action=="selecionar")&&(data.origem=="matricula")&&(ModuleDefs.Entity=="Aluno")) {

			if(data.Options["TotalItens"]>1) {


				/*#### EXIBE CAIXA DE DIÁLOGO PARA ESCOLHER O ALUNO ####*/
				var dialog = bootbox.dialog({
					title: 'Selecionar aluno',
					message: '<div class="row"><div class="col-xs-12">Sua pesquisa retornou mais de um aluno, por favor, escolha o aluno na lista abaixo: <br></div>\
								<br/>\
								<div class="col-xs-12">\
									<div id="ResultadoAlunos"></div>\
									<div id="msg-escolher" class="bg-danger">Escolha um aluno</div>\
								</div></div>',
					buttons: {
					    cancel: {
					        label: "Cancelar",
					        className: 'btn-primary',
					    },
					    ok: {
					        label: "Escolher",
					        className: 'btn-success',
					        callback: function(){
					        	if($('input[name=res_pesq_alun_id]:checked').val()>0) {

					        		var id_aluno = $('input[name=res_pesq_alun_id]:checked').val();

									$("#"+IdElementForm+" #alunos_alun_id").val();

									$("#"+IdElementForm+" input[name=alun_nome]").val($('#txt_alun_nome_'+id_aluno).html());
									$("#"+IdElementForm+" input[name=alun_cpf]").val($('#txt_alun_cpf_'+id_aluno).html());
									$("#"+IdElementForm+" input[name=alun_rg]").val($('#txt_alun_rg_'+id_aluno).html());
									$("#"+IdElementForm+" input[name=alun_dtnascimento]").val($('#txt_alun_dtnascimento_'+id_aluno).html());
									$("#"+IdElementForm+" input[name=alunos_alun_id]").val(id_aluno);

									$("#"+IdElementForm+" input[name=alun_nome]").closest('.form-group').slideDown();
									$("#"+IdElementForm+" input[name=alun_cpf]").closest('.form-group').slideDown();
									$("#"+IdElementForm+" input[name=alun_rg]").closest('.form-group').slideDown();
									$("#"+IdElementForm+" input[name=alun_dtnascimento]").closest('.form-group').slideDown();


					        	} else {
					        		$('#msg-escolher').fadeIn();
					        		return false;
					        	}
					        }
					    }
					}
				});

				$("#ResultadoAlunos").html('');

				$('#msg-escolher').hide();

				var tabela = $('<table class="table table-striped table-hover">\
									<thead>\
										<tr>\
											<th>&nbsp</th>\
											<th>Nome</th>\
											<th>CPF</th>\
											<th>RG</th>\
											<th>Nascimento</th>\
										</tr>\
									</thead>\
									<tbody>\
									</tbody>\
								</table>');

				$.each(data, function(key, DataObject ) {

					if(DataObject) {

						console.log(DataObject);
						console.log(typeof DataObject);
						console.log(DataObject.hasOwnProperty('alun_id'));

						if(DataObject.hasOwnProperty('alun_id')==true) {

							tabela.find('tbody').append('<tr>\
															<td><label class="radio radio-inline" style="margin-top:0px;"><input type="radio" name="res_pesq_alun_id" id="res_pesq_alun_id_'+DataObject.alun_id+'" value="'+DataObject.alun_id+'" class="radiobox style-2" /><span class="lbl"></span></label></td>\
															<td><span id="txt_alun_nome_'+DataObject.alun_id+'">'+DataObject.alun_nome+'</span></td>\
															<td><span id="txt_alun_cpf_'+DataObject.alun_id+'">'+DataObject.alun_cpf+'</span></td>\
															<td><span id="txt_alun_rg_'+DataObject.alun_id+'">'+DataObject.alun_rg+'</span></td>\
															<td><span id="txt_alun_dtnascimento_'+DataObject.alun_id+'">'+DataObject.alun_dtnascimento+'</span></td>\
														</tr>');
						}
					}
				});

				$("#ResultadoAlunos").html(tabela);
				/*#### EXIBE CAIXA DE DIÁLOGO PARA ESCOLHER O ALUNO ####*/

			}



			else if(data.Options["TotalItens"]==1) {

				$("#"+IdElementForm+" input[name=alun_nome]").val(data[0].alun_nome);
				$("#"+IdElementForm+" input[name=alun_cpf]").val(data[0].alun_cpf);
				$("#"+IdElementForm+" input[name=alun_rg]").val(data[0].alun_rg);
				$("#"+IdElementForm+" input[name=alun_dtnascimento]").val(data[0].alun_dtnascimento);
				$("#"+IdElementForm+" input[name=alunos_alun_id]").val(data[0].alun_id);

				$("#"+IdElementForm+" input[name=alun_nome]").closest('.form-group').slideDown();
				$("#"+IdElementForm+" input[name=alun_cpf]").closest('.form-group').slideDown();
				$("#"+IdElementForm+" input[name=alun_rg]").closest('.form-group').slideDown();
				$("#"+IdElementForm+" input[name=alun_dtnascimento]").closest('.form-group').slideDown();
			}
			else {

				$("#"+IdElementForm+" input[name=alun_nome]").val('');
				$("#"+IdElementForm+" input[name=alun_cpf]").val('');
				$("#"+IdElementForm+" input[name=alun_rg]").val('');
				$("#"+IdElementForm+" input[name=alun_dtnascimento]").val('');
				$("#"+IdElementForm+" input[name=alunos_alun_id]").val('');

				$("#"+IdElementForm+" input[name=alun_nome]").closest('.form-group').slideUp();
				$("#"+IdElementForm+" input[name=alun_cpf]").closest('.form-group').slideUp();
				$("#"+IdElementForm+" input[name=alun_rg]").closest('.form-group').slideUp();
				$("#"+IdElementForm+" input[name=alun_dtnascimento]").closest('.form-group').slideUp();

				AlertMsg('erro', 'error', '', '', 'Não foram localizados alunos com os termos pesquisados, tente novamente ou realize um cadastro de novo aluno.');
			}
		}
		/*### AÇÕES QUANDO RETORNA A BUSCA DE ALUNOS PARA NOVA MATRÍCULA ###*/



		/*### AÇÕES QUANDO RETORNA DA ESCOLHA DO CURSO ###*/
		if((action=="selecionar")&&(data.origem=="matricula")&&(ModuleDefs.Entity=="Curso")) {

			// $("#"+IdElementForm+" :input[id=cursos_curs_id]").val(data[0].curs_id).select2().trigger('change');

			$("#"+IdElementForm+" input[name=curs_valor_matricula]").val(data[0].curs_valor_matricula);
			$("#"+IdElementForm+" input[name=curs_valor_mensalidade]").val(data[0].curs_valor_mensalidade);
			$("#"+IdElementForm+" input[name=curs_duracao]").val(data[0].curs_duracao);
			$("#"+IdElementForm+" input[name=curs_periodo]").val(data[0].curs_periodo);

			$("#"+IdElementForm+" input[name=curs_valor_matricula]").closest('.form-group').slideDown();
			$("#"+IdElementForm+" input[name=curs_valor_mensalidade]").closest('.form-group').slideDown();
			$("#"+IdElementForm+" input[name=curs_duracao]").closest('.form-group').slideDown();
		}
		/*### AÇÕES QUANDO RETORNA DA ESCOLHA DO CURSO ###*/

	}
	/*### FUNÇÃO PARA EXECUTAR AÇÕES ADICIONAIS AO ACTIONFORM ###*/



	// pagefunction

	var pagefunction = function() {


		//ID DO ELEMENTO TABLE DO GRID
		var IdElementDataTable = 'datatable_fixed_column';

		//ID DO ELEMENTO FORM DE CADASTRO PRINCIPAL
		var IdElementForm = 'form-cadastro';

		//ID DO ELEMENTO MODAL DE CADASTRO PRINCIPAL
		var IdModalElement = 'modal-cadastro';


		/*### DEFINIÇÕES GERAIS DO MÓDULO ###*/
		var ModuleDefs = {
			"Name":"Matricula", //IDENTIFICADOR INTERNO DO MÓDULO (REFERÊNCIA PARA PERMISSÃO DE ACESSO)
			"Prefix":"matr_", //PREFIXO DOS CAMPOS DO MÓDULO (USADOS NA TABELA DO BANCO DE DADOS)
			"Title":"Cadastro de Matrículas", //TÍTULO DO MÓDULO
			"Entity":"Matricula", //ENTIDADE DO MÓDULO (REFERÊNCIA PARA CLASSE)
			"Table":"Matriculas", //NOME DA TABELA NO BANCO DE DADOS
			"EntitySingle":"Matrícula", //ENTIDADE DO MÓDULO (SINGULAR)
			"EntityMultiple":"Matrículas" //ENTIDADE DO MÓDULO (PLURAL)
		};
		/*### DEFINIÇÕES GERAIS DO MÓDULO ###*/


		/*### DEFINIÇÕES GERAIS DO MÓDULO DE ALUNOS ###*/
		var ModuleDefsAluno = {
			"Name":"Aluno", //IDENTIFICADOR INTERNO DO MÓDULO (REFERÊNCIA PARA PERMISSÃO DE ACESSO)
			"Prefix":"alun_", //PREFIXO DOS CAMPOS DO MÓDULO (USADOS NA TABELA DO BANCO DE DADOS)
			"Title":"Cadastro de Alunos", //TÍTULO DO MÓDULO
			"Entity":"Aluno", //ENTIDADE DO MÓDULO (REFERÊNCIA PARA CLASSE)
			"Table":"Alunos", //NOME DA TABELA NO BANCO DE DADOS
			"EntitySingle":"Aluno", //ENTIDADE DO MÓDULO (SINGULAR)
			"EntityMultiple":"Alunos" //ENTIDADE DO MÓDULO (PLURAL)
		};
		/*### DEFINIÇÕES GERAIS DO MÓDULO DE ALUNOS ###*/



		//CHAMA A FUNÇÃO QUE SETA OS DADOS BÁSICOS DO MÓDULO E ENTIDADE
		SetModuleEntity(ModuleDefs);

		//MARCA OS CAMPOS DO FORMULÁRIO COMO OBRIGATÓRIOS
		MarkRequiredFields (IdElementForm);


		/*### DEFINIÇÕES DAS COLUNAS DO GRID (PRIMEIRA COLUNA É ZERO) ###*/
		var ColumnDefs = [
			{ "name":"ID","data":"DT_RowId", "primary_key":"id", "DataType":"int", "width":"4%", "orderable":false, "minSearchValue":1, "width":"6%", "responsive": { "class":"expand" }, "DT_Filter": { "hasFilter": true, "type":"input" },  },
			{ "name":"curso", "data":"cursos_curs_id", "DataType":"int", "visible":false, "otherTable":{ "Table":"cursos", "Alias":"Cursos", "Prefix":"curs_", "Join":"INNER", "FieldKey":"cursos_curs_id", "FieldKeyOtherTable":"curs_id", "View":"curs_id"} },
			{ "name":"Ano", "data":"ano", "width":"8%", "DT_Filter": { "hasFilter": true, "type":"input" }, },
			{ "name":"Curso", "data":"curso_nome", "width":"22%", "DT_Filter": { "hasFilter": true, "type":"input", "searchOperator":"LIKE" }, "otherTable":{ "View":"CAST(cursos.curs_nome as varchar)||' - '||CAST(cursos.curs_ch as varchar)||'h'"} },
			{ "name":"Período", "data":"periodo_nome", "width":"12%", "DT_Filter": { "hasFilter": true, "type":"input" }, "otherTable":{"Alias":"Periodos", "OtherJoin":"INNER JOIN TabelasDinamicasValores Periodos ON Periodos.TabeDinaValo_Codigo = CAST(cursos.curs_periodo AS VARCHAR) AND Periodos.TabeDinaValo_Tabela = 'TURNOS' AND Periodos.TabeDinaValo_Delete = 0", "View":"TabeDinaValo_Descricao"} },
			{ "name":"Aluno", "data":"aluno_nome", "width":"26%", "DT_Filter": { "hasFilter": true, "type":"input", "searchOperator":"LIKE" }, "otherTable":{ "Table":"alunos", "Alias":"alunos", "Prefix":"alun_", "Join":"INNER", "FieldKey":"alunos_alun_id", "FieldKeyOtherTable":"alun_id", "View":"alun_nome"} },
			{ "name":"Status", "data":"status_nome", "width":"12%", "DT_Filter": { "hasFilter": true, "type":"input" }, "otherTable":{ "DynamicTable":"STATUS_MATRICULAS", "Join":"INNER", "FieldKey":"status", "FieldKeyOtherTable":"codigo", "View":"descricao"} },
			{ "name":"Status Pgto", "data":"status_pgto_nome", "width":"12%", "DT_Filter": { "hasFilter": true, "type":"input" }, "otherTable":{ "DynamicTable":"STATUS_PAGAMENTOS", "Join":"INNER", "FieldKey":"paga", "FieldKeyOtherTable":"codigo", "View":"descricao"} },
			{ "name":"aluno", "data":"alunos_alun_id", "DataType":"int", "noPrefix":true, "visible":false },
			{ "name":"status", "data":"status", "DataType":"int", "visible":false },
			{ "name":"status_pgto", "data":"paga", "DataType":"int", "visible":false },
			{ "name":"cpf_aluno", "data":"aluno_cpf", "visible":false, "otherTable":{ "Alias":"alunos", "View":"alun_cpf"} },
			{ "name":"actions", "data":"acoes", "width":"4%", "orderable":false, "searchable":false, "defaultContent":'<button type="button" data-id="alterar" title="Visualizar" class="btn btn-primary btn-xs"><i class="fa fa-search"></i></button>' },
		];
		/*### DEFINIÇÕES DAS COLUNAS DO GRID (PRIMEIRA COLUNA É ZERO) ###*/





		/*### ORDENAÇÃO INICIAL DO GRID (PRIMEIRA COLUNA É ZERO) ###*/
		var ColumnOrder = [
			[2, "asc"],
			[4, "asc"]
		];
		/*### ORDENAÇÃO INICIAL DO GRID (PRIMEIRA COLUNA É ZERO) ###*/




		/*### OBJETO OTHERTABLE PARA CURSOS JÁ EXISTENTES ###*/
		var OtherTableCursos = {
			"Table":"Cursos",
			"Prefix":"curs_",
			"Key":"id",
			"Desc":"CAST(TBL.curs_nome as varchar)||' - '||CAST(TBL.curs_ch as varchar)||'h - '||CAST(Periodos.TabeDinaValo_Descricao as varchar)",
			"OtherDesc":true,
			"Condition":"",
			"FieldToOrder":"CAST(TBL.curs_nome as varchar)||' - '||CAST(TBL.curs_ch as varchar)||'h - '||CAST(Periodos.TabeDinaValo_Descricao as varchar) ASC, TBL.curs_id ASC",
			"OtherOrder":true,
			"Join":"INNER JOIN TabelasDinamicasValores Periodos ON Periodos.TabeDinaValo_Codigo = CAST(TBL.curs_periodo AS VARCHAR) AND Periodos.TabeDinaValo_Tabela = 'TURNOS' AND Periodos.TabeDinaValo_Delete = 0",
			"Distinct":true,
		};
		/*### OBJETO OTHERTABLE PARA CURSOS JÁ EXISTENTES ###*/

		//ARMAZENA OS CURSOS EM OBJETO
		var cursos = GetDynamicTable('','','',OtherTableCursos);

		//POPULA O SELECT2 DO FILTRO COM OS CURSOS
		SetSelectFromDynamicTable('filtro_curso',cursos,'Cursos','Todos os cursos','');

		//POPULA O SELECT2 AUXILIAR COM OS CURSOS
		SetSelectFromDynamicTable('cursos_curs_id',cursos,'Curso','','');


		//ARMAZENA OS STATUS EM OBJETO
		var status = GetDynamicTable('STATUS_MATRICULAS','Descricao','ASC','');

		//POPULA O SELECT2 COM OS STATUS
		SetSelectFromDynamicTable('matr_status',status,'Status da Matrícula','','');

		//POPULA O SELECT2 DO FILTRO COM OS STATUS
		SetSelectFromDynamicTable('filtro_status',status,'Status das Matrículas','Todos os status','');

		//ARMAZENA O STATUS DE PAGAMENTO
		var status_pgto = GetDynamicTable('STATUS_PAGAMENTOS','Descricao','ASC','');

		//POPULA O SELECT2 DO FILTRO COM OS STATUS
		SetSelectFromDynamicTable('filtro_status_pgto',status_pgto,'Matrícula paga?','Todos os status','');




		/*### CHAMA O GRID ###*/
		var DataTable = GenerateDataTable(IdElementDataTable, '', ModuleDefs, ColumnDefs, ColumnOrder, IdElementForm, IdModalElement);
		/*### CHAMA O GRID ###*/


		/*### ATIVA A VALIDAÇÃO DO FORMULÁRIO ###*/
		FormValidation(IdElementForm, IdElementDataTable, DataTable, ModuleDefs, IdModalElement)
		/*### ATIVA A VALIDAÇÃO DO FORMULÁRIO ###*/






		/*### AÇÕES QUANDO REALIZA A BUSCA DE UM ALUNO ###*/
		$("#"+IdElementForm+" #btn-pesquisa-aluno").on('click', function(event) {

			var searchKey = $("#"+IdElementForm+" #pesq_aluno").val();

			if (searchKey.length<3) {

				AlertMsg('erro', 'alert', '', '', 'Digite pelo menos três carateres para realizar a busca.');
			}

			else {

				//CRIA O formData
				var formData = new FormData();

				//INFORMA A CHAVE DE PESQUISA
				formData.append('serchKey',searchKey);

				//ADICIONA O ORIGEM
				formData.append('origem','matricula');

				//LIMPA OS DADOS DO ALUNO
				LimpaAluno(IdElementForm);

				//PREENCHE O FORMULÁRIO DE PESSOAS
				ActionForm('selecionar', formData, '', IdElementDataTable, DataTable, IdElementForm, ModuleDefsAluno, IdModalElement);
			}
		});
		/*### AÇÕES QUANDO REALIZA A BUSCA DE UM ALUNO ###*/





		/*#### AÇÕES QUANDO CLICA NO BOTÃO PAGAR ####*/
		$("#btn-pagar").on('click', function(event) {

			/*#### EXIBE CAIXA DE DIÁLOGO PARA PAGAR A MATRÍCULA E/OU MENSALIDADE ####*/
			var dialog = bootbox.dialog({
				title: 'Pagar matrícula e mensalidades',
				message: '<div class="row"><div class="col-xs-12">Marque abaixo os itens que deseja pagar: <br></div>\
							<br/>\
							<div class="col-xs-12">\
								<form name="form-pagamento" id="form-pagamento">\
									<div id="TabelaParcelas"></div>\
								</form>\
								<div id="msg-escolher" class="bg-danger">Escolha um item para realizar o pagamento</div>\
							</div>\
							<div class="col-xs-3">\
								<label for="res_total_pagar" class="control-label">Total a pagar </label><input type="text" name="res_total_pagar" id="res_total_pagar" class="form-control" readonly />\
							</div>\
							<div class="col-xs-3">\
								<label for="res_total_recebido" class="control-label">Total recebido </label><input type="text" name="res_total_recebido" id="res_total_recebido" class="form-control" onkeyup="MaskCurrency(this)" style="text-align: right;" />\
							</div>\
							<div class="col-xs-6">\
								<label for="res_troco" class="control-label">Troco </label><br><span id="res_troco"></span>\
							</div>\
						</div>',
				buttons: {
				    cancel: {
				        label: "Cancelar",
				        className: 'btn-primary',
				    },
				    ok: {
				        label: "Pagar",
				        className: 'btn-success',
				        callback: function(){
				        	console.log("ok");
				        }
				    }
				}
			});

			$("#TabelaParcelas").html($("#tblParcelas").html());

			var total_pagar = 0;

			$("#TabelaParcelas").on('click', 'input[type=checkbox]', function(event) {

				// console.log(total_pagar);
				// console.log($(this).val());
				// console.log($(this).data('value'));
				// console.log(Number($(this).data('value')));

				if($(this).prop('checked')==true) {

					total_pagar += Number($(this).data('value'));
				} else {

					total_pagar -= Number($(this).data('value'));
				}

				$("#res_total_pagar").val(total_pagar);

			});

			$("#res_total_recebido").on('keyup', function(event) {

				// console.log("keyup");
				var valor = $(this).val();

				valor = valor.replace(".","");
				valor = valor.replace(",",".");

				var troco = Number(valor) - Number($("#res_total_pagar").val());

				var trocoFormat = troco;

				// console.log("troco");
				// console.log(troco);

				if(Number(troco)<0) {

					$("#res_troco").html("Valor insuficiente para realizar o pagamento");
				}
				else if(Number(troco)==0) {

					$("#res_troco").html("R$ 0 (troco não necessário)");
				}
				else {

					// console.log("troco cedulas");

					var cedulasDisponiveis = [100,50,10,5,1,0.50,0.10,0.05,0.01];

					var cedulasTroco = new Array();

					var texto_cedulas = "";

					for (x in cedulasDisponiveis) {

						if (cedulasDisponiveis[x] > troco) continue;

						var quantidadeCedula = parseInt(troco / cedulasDisponiveis[x]);
						cedulasTroco.push([quantidadeCedula, cedulasDisponiveis[x]]);
						troco = troco - (quantidadeCedula * cedulasDisponiveis[x]);

						if(cedulasDisponiveis[x]>1) {

							texto_cedulas += quantidadeCedula + " nota(s) de " + (cedulasDisponiveis[x]).formatMoney(2, ',', '.') + ", ";
						}
						else {

							texto_cedulas += quantidadeCedula + " moeda(s) de " + (cedulasDisponiveis[x]).formatMoney(2, ',', '.') + ", ";
						}
					}

					// console.log(cedulasTroco);
					// console.log(texto_cedulas.slice(0,-2));

					$("#res_troco").html("R$ " + (trocoFormat).formatMoney(2, ',', '.') + "<br>" + texto_cedulas.slice(0,-2));

					//TODO: FINALIZAR PARTE DE PAGAMENTO
				}

			});
			$('#msg-escolher').hide();
			/*#### EXIBE CAIXA DE DIÁLOGO PARA PAGAR A MATRÍCULA E/OU MENSALIDADE ####*/

		});
		/*#### AÇÕES QUANDO CLICA NO BOTÃO PAGAR ####*/
	};

	// end pagefunction

	// destroy generated instances
	// pagedestroy is called automatically before loading a new page
	// only usable in AJAX version!

	var pagedestroy = function(){

		/*
		Example below:

		$("#calednar").fullCalendar( 'destroy' );
		if (debugState){
			root.console.log("✔ Calendar destroyed");
		}

		For common instances, such as Jarviswidgets, Google maps, and Datatables, are automatically destroyed through the app.js loadURL mechanic

		*/
	}

	// end destroy

	// run pagefunction

	/*#### CARREGAR SCRIPTS ESPECÍFICOS ####*/
	loadScript("src/Javascript/Functions.Matricula.js?asd", pagefunction);
	/*#### CARREGAR SCRIPTS ESPECÍFICOS ####*/

	// load related plugins



</script>
